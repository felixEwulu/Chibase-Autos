(function(){!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function o(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function t(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(c," ")),u.json?JSON.parse(e):e}catch(e){}}function r(n,o){var i=u.raw?n:t(n);return e.isFunction(o)?o(i):i}var c=/\+/g,u=e.cookie=function(t,c,s){if(arguments.length>1&&!e.isFunction(c)){if("number"==typeof(s=e.extend({},u.defaults,s)).expires){var d=s.expires,f=s.expires=new Date;f.setMilliseconds(f.getMilliseconds()+864e5*d)}return document.cookie=[n(t),"=",i(c),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}for(var a=t?void 0:{},p=document.cookie?document.cookie.split("; "):[],l=0,m=p.length;l<m;l++){var x=p[l].split("="),g=o(x.shift()),j=x.join("=");if(t===g){a=r(j,c);break}t||void 0===(j=r(j))||(a[g]=j)}return a};u.defaults={},e.removeCookie=function(n,o){return e.cookie(n,"",e.extend({},o,{expires:-1})),!e.cookie(n)}})})();(function($){"use strict";function unique(array){return array.filter(function(el,index,arr){return index==arr.indexOf(el)})}
function sortProperties(obj){var sortable=[];for(var key in obj)
if(obj.hasOwnProperty(key))
sortable.push([key,obj[key]]);sortable.sort(function(a,b){var x=a[1].toString().toLowerCase(),y=b[1].toString().toLowerCase();return x<y?-1:x>y?1:0});return sortable}
var valid="invalid";function validateFilter(depth,filter){var make=filter.find('select[name="make"]'),model=filter.find('select[name="model"]'),year=filter.find('select[name="year"]'),trim=filter.find('select[name="trim"]');var makeSelected=make.find('option:selected').val(),modelSelected=model.find('option:selected').val(),yearSelected=year.find('option:selected').val(),trimSelected=trim.find('option:selected').val();var makeValid='invalid',modelValid='invalid',yearValid='invalid',trimValid='invalid';switch(depth){case 'trim':if(!makeSelected.length||makeSelected==null){make.next('.alert').addClass('active')}else{makeValid='valid'}
if(!modelSelected.length||modelSelected==null){model.next('.alert').addClass('active')}else{modelValid='valid'}
if(!yearSelected.length||yearSelected==null){year.next('.alert').addClass('active')}else{yearValid='valid'}
if(!trimSelected.length||trimSelected==null){trim.next('.alert').addClass('active')}else{trimValid='valid'}
if(makeValid=='valid'&&modelValid=='valid'&&yearValid=='valid'&&trimValid=='valid'){valid="valid"}
break;case 'model':if(!makeSelected.length||makeSelected==null){make.next('.alert').addClass('active')}else{makeValid='valid'}
if(!modelSelected.length||modelSelected==null){model.next('.alert').addClass('active')}else{modelValid='valid'}
if(makeValid=='valid'&&modelValid=='valid'){valid="valid"}
break;case 'make':if(!makeSelected.length||makeSelected==null){make.next('.alert').addClass('active')}else{makeValid='valid'}
if(makeValid=='valid'){valid="valid"}
break}}
function resetFilter(filter){filter.find('select[name="make"] option.default').prop('selected','selected');filter.find('select[name="model"] option.default').prop('selected','selected').show(0).siblings().prop('selected','').hide(0);filter.find('select[name="trim"] option.default').prop('selected','selected').show(0).siblings().prop('selected','').hide(0);filter.find('select[name="year"] option.default').prop('selected','selected').show(0).siblings().prop('selected','').hide(0)}
function createURL(shopURL,data){if(shopURL.indexOf("?")==-1&&data.make.length){shopURL+='?'}
$.each(data,function(key,value){if(value.length){shopURL+='&'+key+'='+value}});shopURL=encodeURI(shopURL);return shopURL}
function updateUserVehicles(data){var user_id=data.user_id;if(typeof(user_id)!='undefined'&&user_id!=null){$.ajax({type:'POST',url:data.url,data:{action:'widget_user_vehicle_update',user_id:data.user_id,vehicle:data.vehicle,nonce:data.nonce}}).done(function(response){if(typeof(data.message)!='undefined'&&data.message!=null&&data.event=='save'){alert(data.message);$('.user-vehicle-list.dashboard').parent().find('.vehicle-header').addClass('visible');$('.user-vehicle-list.dashboard').html(data['dashboard-vehicles'])}}).fail(function(data){alert(vehicle_opt.error_vehicle)}).always(function(){if(data.event=='save'){data.filter.find(".save-vehicle").removeClass('visible')}
data.filter.find(".load").remove();data.filter.find(".user-vehicle-list").getNiceScroll().resize();resetFilter(data.filter)})}
if(typeof($.cookie('user-car'))!='undefined'){if($.removeCookie('user-car',{path:'/'})){if(typeof(data.user_id)=='undefined'){alert(data.message);$.cookie('user-car',data.vehicle,{expires:90,path:'/'})}}}}
function toggleDefault($sel,change){if($sel.find('option').length>1){var selected=$sel.find('option:selected').val();if(typeof(selected)!='undefined'&&selected!=null&&selected.length&&change==!0){$sel.closest('form[name="et-add-vehicle"]').addClass('loading');if($sel.attr('name')!='make'){jsonURL=jsonURL.replace('product-model','product-trim')}else{jsonURL=jsonURLModel};if(jsonURL.indexOf('&'+$sel.attr('name'))!=-1){jsonURL=jsonURL.split("?");var jsonURLStart=jsonURL[0]+'?';jsonURL=jsonURL.pop();jsonURL=jsonURL.split("&");var dataObj={};for(var i=0;i<jsonURL.length;i++){var property=jsonURL[i].split("=");var key=(property[0]);var value=(property[1]);dataObj[key]=value}
if($sel.attr('name')in dataObj){dataObj[$sel.attr('name')]=selected}
var jsonURLArray=[];var loop=!0;$.each(dataObj,function(index,value){if(loop){jsonURLArray.push(index+'='+value);if(index==$sel.attr('name')){loop=!1}}});jsonURLArray=jsonURLArray.join('&');jsonURL=jsonURLStart+jsonURLArray}else{jsonURL+='&'+$sel.attr('name')+'='+selected}
$.ajax({dataType:'json',url:jsonURL}).done(function(response){var nextSel=$sel.parent().next().find('select');if(typeof(nextSel)!='undefined'&&nextSel!=null&&nextSel.length){var output='';var attrData={};var nextSelName=nextSel.attr('name');$sel.parent().nextAll().find('select').find('option').not('.default').remove();$.each(response,function(index,object){if(nextSelName=='year'){attrData[object.year]=object.year}else{attrData[object.id]=object.name}});if(typeof(attrData)!='undefined'&&attrData!=null){attrData=sortProperties(attrData);$.each(attrData,function(index,value){output+='<option value="'+value[0]+'">'+value[1]+'</option>'})}
if(output.length){nextSel.append(output)}
setTimeout(function(){$sel.closest('form[name="et-add-vehicle"]').removeClass('loading')},500)}}).fail(function(response){$sel.closest('form[name="et-add-vehicle"]').removeClass('loading');var message=opt.errorMessage;alert(message)})}}}
var $output='';var jsonURL='';var jsonURLModel=vehicle_opt.jsonUrlModel;jsonURLModel+='?per_page=1000';var jsonURLTrim=vehicle_opt.jsonUrlTrim;jsonURLTrim+='?per_page=1000';$('.widget_user_vehicle_widget').each(function(){var $this=$(this),shopURL=$this.find('.add-vehicle').data('shop'),make=$this.find('select[name="make"]'),depth='trim',makeSelect=make.find('option:selected').val(),moreDefaultText=$this.find('.add-more-vehicle').text();if($this.find('.add-vehicle').hasClass('depth-model')){depth='model'}else if($this.find('.add-vehicle').hasClass('depth-make')){depth='make'}
$this.find('.add-more-vehicle').on('click',function(e){e.preventDefault();var $more=$(this);$more.toggleClass('active');$more.next('div').toggle(0,function(){if($more.hasClass('active')){$more.text(vehicle_opt.more_vehicle)}else{$more.text(moreDefaultText)}})});if($output.length){$this.find('form').append($output)}
var defaultSelect=$this.find('select');var totalDefaults=defaultSelect.length;defaultSelect.each(function(index,value){var $sel=$(this);toggleDefault($sel,!1);$sel.on('change',function(){var $opt=$sel.find("option:selected").val();if(index!=totalDefaults-1){toggleDefault($(this),!0)}
if(''!==$opt){$sel.next('.alert').removeClass('active')}})});$this.find('.add-vehicle-button').on('click',function(e){e.preventDefault();$this.find('.alert').removeClass('active');validateFilter(depth,$this);if(valid=="valid"){var vehicle=new Array,vehicleData=new Array,objectVehicle=new Object,objectVehicleData=new Object;vehicle.push($this.find('select[name="make"] option:selected').text());vehicleData.push($this.find('select[name="make"] option:selected').val());objectVehicle.make=vehicle[0];objectVehicleData.make=vehicleData[0];switch(depth){case 'model':vehicle.push($this.find('select[name="model"] option:selected').text());vehicleData.push($this.find('select[name="model"] option:selected').val());objectVehicle.model=vehicle[1];objectVehicleData.model=vehicleData[1];break;case 'trim':vehicle.push($this.find('select[name="model"] option:selected').text());vehicleData.push($this.find('select[name="model"] option:selected').val());objectVehicle.model=vehicle[1];objectVehicleData.model=vehicleData[1];vehicle.push($this.find('select[name="year"] option:selected').text());vehicle.push($this.find('select[name="trim"] option:selected').text());vehicleData.push($this.find('select[name="year"] option:selected').val());vehicleData.push($this.find('select[name="trim"] option:selected').val());objectVehicle.yr=vehicle[2];objectVehicle.trim=vehicle[3];objectVehicleData.yr=vehicleData[2];objectVehicleData.trim=vehicleData[3];break}
var dataVehicle=vehicleData.join(':');if(typeof($.cookie('user-car'))!='undefined'){var oldCookie=$.cookie('user-car');if($.removeCookie('user-car',{path:'/'})){var newCookie=oldCookie+'|'+dataVehicle;$.cookie('user-car',newCookie,{expires:90,path:'/'})}}else{$.cookie('user-car',dataVehicle,{expires:90,path:'/'})}
var $output="";var $unique=!0;$this.find('.user-vehicle-list li').each(function(){if($(this).data('car')==dataVehicle){alert(vehicle_opt.exists_vehicle);$unique=!1}});if($unique){$output+='<li data-car="'+dataVehicle+'"><span class="remove ien-eclose-3"></span><a href="'+createURL(shopURL,objectVehicleData)+'">';switch(depth){case 'make':$output+='<h6>'+objectVehicle.make+'</h6>';break;case 'model':$output+='<h6>'+objectVehicle.make+' '+objectVehicle.model+'</h6>';break;case 'trim':$output+='<h6>'+objectVehicle.yr+' '+objectVehicle.make+' '+objectVehicle.model+'</h6>';$output+='<span>'+objectVehicle.trim+'</span>';break}
$output+='</a></li>';$('.user-vehicle-list').each(function(){$(this).prepend($output);$(this).find('li:first-child').addClass('new')});$('.vehicle-header').each(function(){$(this).addClass('visible')});$this.find('.save-vehicle').addClass('visible');$this.find('.add-more-vehicle').addClass('visible');$this.find('.add-more-vehicle').next('div').hide(0,function(){$this.find('.add-more-vehicle').removeClass('active').text(moreDefaultText)});$('.user-vehicle-list').each(function(){$(this).find('li:first-child').removeClass('new')})}
resetFilter($this)}});var updateData=new Object;updateData.filter=$this;updateData.url=$this.find('.et-add-vehicle').attr('action');updateData.user_id=$this.find('.add-vehicle').data('user');updateData.nonce=$this.find('#widget_user_vehicle_update_nonce').val();$this.find('.save-vehicle').on('click',function(e){updateData.event='save';updateData.message=vehicle_opt.save_vehicle;if($('body').hasClass('logged-in')){e.preventDefault();$this.find('form').append('<div class="load"></div>');var currentVehicles=new Array;var dashboardVehicles=$this.find('.user-vehicle-list').html();updateData['dashboard-vehicles']=dashboardVehicles;$this.find('.user-vehicle-list li').each(function(){currentVehicles.push($(this).data('car'))});updateData.vehicle=currentVehicles.join('|');updateUserVehicles(updateData)}});$(document).on("click",".user-vehicle-list li span.remove",function(){if(confirm(vehicle_opt.remove_vehicle)){updateData.event='remove';var dataCar=$(this).parent().data('car');$('.user-vehicle-list').each(function(){$(this).find('li[data-car="'+dataCar+'"]').remove()});var currentVehicles=new Array;$this.find('.user-vehicle-list li').each(function(){currentVehicles.push($(this).data('car'))});updateData.vehicle=currentVehicles.join('|');updateUserVehicles(updateData);if(!$this.find('.user-vehicle-list li').length){$this.find('.save-vehicle').removeClass('visible');$('.vehicle-header').each(function(){$(this).removeClass('visible')});$this.find('.add-more-vehicle').removeClass('visible');$this.find('.vehicle-form').show(0)}}});$(document).mouseup(function(e){if(!$this.parents('.et-header-button').is(e.target)&&$this.parents('.et-header-button').has(e.target).length===0){$this.parents('.megamenu').removeClass('active')}});$(document).on("click",".user-vehicle-list li a",function(){var car=new Object,currentCar=$(this).parent().attr('data-car'),currentCarText=$(this).find('h6').html();currentCar=currentCar.split(':');currentCarText=currentCarText.split(' ');car.make=currentCar[0];car.model=currentCar[1]+':'+currentCarText[2];car.year=currentCar[2];car.trim=currentCar[3]+':'+$(this).find('span').html();localStorage.setItem('currentCar',JSON.stringify(car))})})})(jQuery)